# Bilistream

[English](README.md) | [ä¸­æ–‡](README.zh_CN.md)

## åŠŸèƒ½ç‰¹ç‚¹

- è‡ªåŠ¨å°† Twitch å’Œ YouTube ç›´æ’­è½¬æ’­åˆ°å“”å“©å“”å“©ç›´æ’­
- æ”¯æŒ YouTube çš„é¢„å®šç›´æ’­
- å¯é…ç½®/è‡ªåŠ¨æ›´æ–°çš„å“”å“©å“”å“©ç›´æ’­è®¾ç½®ï¼ˆæ ‡é¢˜ã€åˆ†åŒºå’Œå°é¢ï¼‰
- **ç°ä»£åŒ– Web UI** - ç²¾ç¾çš„æ§åˆ¶é¢æ¿ï¼Œç”¨äºç›‘æ§å’Œç®¡ç†ç›´æ’­
- äº¤äº’å¼è®¾ç½®å‘å¯¼ï¼Œè½»æ¾å®Œæˆé¦–æ¬¡é…ç½®
- ç®¡ç†è„šæœ¬ï¼ˆ`stream_manager.sh`ï¼‰ç”¨äºæ›´æ”¹é…ç½®
- å½“å“”å“©å“”å“©æœªè½¬æ’­æ—¶å¯é€šè¿‡å¼¹å¹•å‘½ä»¤æ›´æ”¹ç›‘å¬ç›®æ ‡é¢‘é“
- ç›‘æ§è‹±é›„è”ç›Ÿæ¸¸æˆå†…ç©å®¶åç§°ï¼Œå¦‚å‘ç°é»‘åå•è¯æ±‡åˆ™åœæ­¢ç›´æ’­
- è‡ªåŠ¨æ£€æµ‹å¹¶é¿å…è½¬æ’­å·²è¢«è½¬æ’­çš„é¢‘é“

## ä¾èµ–

**Windows:**
- âœ¨ **è‡ªåŠ¨ä¸‹è½½ï¼** æ ¸å¿ƒä¾èµ–é¡¹ä¼šåœ¨é¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨ä¸‹è½½ï¼š
  - ffmpeg.exe
  - yt-dlp.exe
- **Twitch æ”¯æŒ**ï¼ˆå¯é€‰ï¼‰ï¼š
  - å®‰è£… streamlink: [ä¸‹è½½](https://github.com/streamlink/windows-builds/releases) æˆ– `pip install streamlink`
  - å®‰è£… ttvlol æ’ä»¶: [streamlink-ttvlol](https://github.com/2bc4/streamlink-ttvlol)

**Linux/Mac:**
- ffmpeg
- yt-dlp
- streamlink (éœ€å®‰è£… [2bc4/streamlink-ttvlol](https://github.com/2bc4/streamlink-ttvlol) æ’ä»¶)

## å®‰è£…æ­¥éª¤

1. å…‹éš†ä»“åº“ï¼š

   ```bash
   git clone https://github.com/your-username/bilistream.git
   cd bilistream
   ```
2. å®‰è£…æ‰€éœ€ä¾èµ–ï¼ˆä»¥ Debian ç³»ç»Ÿä¸ºä¾‹ï¼‰ï¼š

   ```bash
   sudo apt update
   sudo apt install ffmpeg python3-pip
   pip install yt-dlp streamlink
   ```
3. å®‰è£… streamlink-ttvlol æ’ä»¶ï¼š
   æŒ‰ç…§ [2bc4/streamlink-ttvlol](https://github.com/2bc4/streamlink-ttvlol) çš„è¯´æ˜è¿›è¡Œæ“ä½œ

4. æ„å»ºé¡¹ç›®ï¼š

   å¯¹äº Debian 12 å’Œå…¶ä»–ä½¿ç”¨ glibc 2.36 æˆ–æ›´æ–°ç‰ˆæœ¬çš„ Linux å‘è¡Œç‰ˆï¼š

   ```bash
   cargo zigbuild --target x86_64-unknown-linux-gnu.2.36 --release
   ```

   å¯¹äº Windowsï¼š

   ```bash
   cargo build --target x86_64-pc-windows-gnu --release
   ```

5. **è®¾ç½® Web UIï¼ˆå¯é€‰ä½†æ¨èï¼‰ï¼š**

   Web UI æ–‡ä»¶å·²åŒ…å«åœ¨ `webui/dist/` ç›®å½•ä¸­ï¼Œæ— éœ€é¢å¤–è®¾ç½®ï¼
   
   è¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯è‡ªåŠ¨å¯åŠ¨ Web ç•Œé¢ï¼š
   ```bash
   ./bilistream webui
   ```
   
   **æ³¨æ„ï¼š** Web UI æ˜¯ä¸€ä¸ªå•é¡µåº”ç”¨ï¼Œæ²¡æœ‰å¤–éƒ¨ä¾èµ–ã€‚æ‰€æœ‰èµ„æºéƒ½æ‰“åŒ…åœ¨ `webui/dist/index.html` æ–‡ä»¶ä¸­ã€‚

6. **å¿«é€Ÿè®¾ç½®ï¼ˆæ¨èï¼‰ï¼š**

   **è‡ªåŠ¨è®¾ç½®:**
   - ç›´æ¥è¿è¡Œ `./bilistream`ï¼ˆæˆ–åœ¨ Windows ä¸ŠåŒå‡»ï¼‰
   - å¦‚æœç¼ºå°‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®å‘å¯¼ä¼šè‡ªåŠ¨å¯åŠ¨
   - æ— éœ€è®°ä½ `setup` å‘½ä»¤ï¼

   **æ‰‹åŠ¨è®¾ç½®:**
   éšæ—¶è¿è¡Œäº¤äº’å¼è®¾ç½®å‘å¯¼ï¼š

   ```bash
   ./bilistream setup
   ```

   è®¾ç½®å‘å¯¼å°†å¼•å¯¼ä½ å®Œæˆï¼š
   - é€šè¿‡äºŒç»´ç ç™»å½•å“”å“©å“”å“©
   - é…ç½®ä»£ç†è®¾ç½®ï¼ˆå¦‚éœ€è®¿é—® YouTube/Twitchï¼‰
   - é…ç½®ä½ çš„å“”å“©å“”å“©ç›´æ’­é—´
   - è®¾ç½® YouTube é¢‘é“åŠåˆ†åŒº IDï¼ˆå¯é€‰ï¼‰
   - è®¾ç½® Twitch é¢‘é“ã€OAuth Token åŠä»£ç†åŒºåŸŸï¼ˆå¯é€‰ï¼‰
   - å¯ç”¨è‡ªåŠ¨å°é¢æ›´æ¢
   - å¯ç”¨å¼¹å¹•æŒ‡ä»¤
   - è®¾ç½®æ£€æµ‹é—´éš”
   - é…ç½®é˜²æ’è½¦ç›‘æ§ï¼ˆå¯è¿­ä»£æ·»åŠ å¤šä¸ªç›‘æ§ç›´æ’­é—´ï¼Œå¯é€‰ï¼‰
   - é«˜çº§é€‰é¡¹ï¼šHolodex API Keyã€Riot API Keyï¼ˆå¯é€‰ï¼‰
   - è‡ªåŠ¨è·å– RTMP æ¨æµåœ°å€

   **æˆ–æ‰‹åŠ¨è®¾ç½®ï¼š**

   æ‰‹åŠ¨é…ç½® `config.yaml`ï¼š

   ```yaml
   # å¤åˆ¶å¹¶ç¼–è¾‘ç¤ºä¾‹é…ç½®
   cp config.yaml.example config.yaml
   ```

   æŸ¥çœ‹ `config.yaml.example` äº†è§£è¯¦ç»†é…ç½®é€‰é¡¹ï¼š

   - å“”å“©å“”å“©ç›´æ’­é—´è®¾ç½®
   - YouTube/Twitch é¢‘é“è®¾ç½®
   - ä¸åŒæ¸¸æˆåˆ†ç±»çš„åˆ†åŒº ID
   - ä»£ç†è®¾ç½®
   - å„ç§æœåŠ¡çš„ API å¯†é’¥
   - é˜²æ’è½¦è®¾ç½®

7. åˆ›å»ºé¢‘é“é…ç½®æ–‡ä»¶ï¼š
   åœ¨æ ¹ç›®å½•åˆ›å»º `channels.json`ï¼Œä½¿ç”¨ä»¥ä¸‹ç»“æ„ï¼š

```json
{
  "channels": [
    {
      "name": "é¢‘é“åç§°",
      "platforms": {
        "youtube": "YouTubeé¢‘é“ID",
        "twitch": "Twitché¢‘é“ID"
      },
      "riot_puuid": "è‹±é›„è”ç›ŸPUUID"  // å¯é€‰
    }
  ]
}
```

8. ï¼ˆå¯é€‰ï¼‰åˆ›å»º `invalid_words.txt` ä»¥ç›‘æ§è‹±é›„è”ç›Ÿæ¸¸æˆå†… IDï¼š

    - åˆ›å»ºåä¸º `invalid_words.txt` çš„æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªè¯
    - åœ¨ config.yaml ä¸­é…ç½® `RiotApiKey` å’Œ `LolMonitorInterval`ï¼š

      ```yaml
      RiotApiKey: "YOUR-RIOT-API-KEY"    # ä» https://developer.riotgames.com/ è·å–
      LolMonitorInterval: 1               # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
      ```
    - ç¨‹åºå°†ç›‘æ§æ¸¸æˆå†…ç©å®¶ï¼Œå¦‚å‘ç°é»‘åå•è¯æ±‡åˆ™åœæ­¢ç›´æ’­

## æ–‡ä»¶ç»“æ„

```txt
.
â”œâ”€â”€ bilistream           # ä¸»ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ areas.json           # åˆ†åŒºï¼ˆæ¸¸æˆç±»åˆ«ï¼‰å’Œç¦ç”¨å…³é”®è¯é…ç½®
â”œâ”€â”€ channels.json        # YouTubeã€Twitch å’Œ PUUID çš„é¢‘é“é…ç½®
â”œâ”€â”€ config.yaml          # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ cookies.json         # å“”å“©å“”å“©ç™»å½• cookiesï¼ˆ./bilistream loginï¼‰
â”œâ”€â”€ invalid_words.txt    # è‹±é›„è”ç›Ÿç©å®¶ ID è¿‡æ»¤è¯ (å¯é€‰)
â””â”€â”€ stream_manager.sh    # ç®¡ç†è„šæœ¬
```

### é…ç½®æ–‡ä»¶è¯´æ˜

#### areas.json
åŒ…å«åˆ†åŒºï¼ˆæ¸¸æˆç±»åˆ«ï¼‰å®šä¹‰å’Œç¦ç”¨å…³é”®è¯ï¼š
```json
{
  "banned_keywords": [
    "gta", "watchalong", "just chatting", ...
  ],
  "areas": [
    { "id": 86, "name": "è‹±é›„è”ç›Ÿ" },
    { "id": 329, "name": "æ— ç•å¥‘çº¦" },
    ...
  ]
}
```

#### channels.json
å®šä¹‰å¯ç›‘æ§çš„é¢‘é“ï¼š
```json
{
  "channels": [
    {
      "name": "é¢‘é“åç§°",
      "platforms": {
        "youtube": "YouTubeé¢‘é“ID",
        "twitch": "Twitché¢‘é“ID"
      },
      "riot_puuid": "è‹±é›„è”ç›ŸPUUID"
    }
  ]
}
```

## ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹

**é¦–æ¬¡ä½¿ç”¨:**
- ç›´æ¥è¿è¡Œç¨‹åºï¼å¦‚æœç¼ºå°‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®å‘å¯¼ä¼šè‡ªåŠ¨å¯åŠ¨
- æŒ‰ç…§äº¤äº’å¼æç¤ºå®Œæˆæ‰€æœ‰é…ç½®

**Linux/Mac:**
```bash
./bilistream 
```
- ç¼ºå°‘é…ç½®ï¼Ÿè®¾ç½®å‘å¯¼è‡ªåŠ¨å¯åŠ¨
- é…ç½®å®Œæˆï¼Ÿå¼€å§‹ç›‘æ§ç›´æ’­

**Windows:**
- **åŒå‡» `bilistream.exe`** - è‡ªåŠ¨å¯åŠ¨ Web UI å¹¶æ˜¾ç¤ºé€šçŸ¥
  - æ˜¾ç¤ºæ‰€æœ‰è®¿é—®åœ°å€ï¼ˆæœ¬åœ°å’Œå±€åŸŸç½‘ IPï¼‰
  - ä¾¿äºè½»æ¾ç®¡ç†
- **CLI æ¨¡å¼**: `bilistream.exe --cli` - å‘½ä»¤è¡Œæ¨¡å¼è¿è¡Œ
  - ç¼ºå°‘é…ç½®ï¼Ÿè®¾ç½®å‘å¯¼è‡ªåŠ¨å¯åŠ¨
- **ä»»ä½•å­å‘½ä»¤**: `bilistream.exe setup`, `bilistream.exe webui` ç­‰

### Web UIï¼ˆæ¨èï¼‰

ä¸ºäº†æ›´æ–¹ä¾¿åœ°ç®¡ç†ï¼Œä½¿ç”¨ Web UIï¼š

```bash
./bilistream webui
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:3150

**Windows ç”¨æˆ·:**
- **é¦–æ¬¡è¿è¡Œ**: æ ¸å¿ƒä¾èµ–é¡¹ï¼ˆffmpegã€yt-dlpï¼‰ä¼šè‡ªåŠ¨ä¸‹è½½åˆ°ç¨‹åºæ–‡ä»¶å¤¹
- **åŒå‡» `bilistream.exe`** è‡ªåŠ¨å¯åŠ¨ Web UI
- ä¼šå¼¹å‡ºé€šçŸ¥æ˜¾ç¤ºæ‰€æœ‰è®¿é—®åœ°å€ï¼š
  - æœ¬åœ°: http://localhost:3150
  - å±€åŸŸç½‘: http://your-ip:3150
- ç‚¹å‡»ä»»æ„åœ°å€åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
- **YouTube è½¬æ’­**: é›¶è®¾ç½®ï¼
- **Twitch è½¬æ’­**: éœ€å•ç‹¬å®‰è£… streamlinkï¼ˆè§ä¾èµ–éƒ¨åˆ†ï¼‰

Web UI æä¾›ï¼š
- ğŸ“Š å®æ—¶çŠ¶æ€ä»ªè¡¨æ¿ï¼Œæ˜¾ç¤º Bilibiliã€YouTube å’Œ Twitch çŠ¶æ€
- ğŸ® ä¸€é”®ç›´æ’­æ§åˆ¶ï¼ˆå¼€å§‹/åœæ­¢ï¼‰
- ğŸ’¬ ç›´æ¥ä»æµè§ˆå™¨å‘é€å¼¹å¹•æ¶ˆæ¯
- ğŸ“º é¢‘é“ç®¡ç† - è½»æ¾åˆ‡æ¢ç›‘æ§ç›®æ ‡
- ğŸ¯ åˆ†åŒºä¸‹æ‹‰é€‰æ‹©ï¼ˆæ— éœ€è®°å¿†åˆ†åŒº IDï¼‰
- âš™ï¸ å®æ—¶æ›´æ–°ç›´æ’­è®¾ç½®
- ğŸ“± ç§»åŠ¨ç«¯å‹å¥½çš„å“åº”å¼ç•Œé¢
- ğŸ”„ æ¯ 60 ç§’è‡ªåŠ¨åˆ·æ–°çŠ¶æ€

### å­å‘½ä»¤

Bilistream æ”¯æŒä»¥ä¸‹å‘½ä»¤ï¼š

1. **è®¾ç½®å‘å¯¼ï¼ˆé¦–æ¬¡ä½¿ç”¨æ¨èï¼‰ï¼š**

   ```bash
   ./bilistream setup
   ```
   
   äº¤äº’å¼è®¾ç½®å‘å¯¼ï¼Œå¸®åŠ©ä½ ï¼š
   - é€šè¿‡äºŒç»´ç ç™»å½•å“”å“©å“”å“©ï¼ˆæˆ–å¤ç”¨ç°æœ‰å‡­è¯ï¼‰
   - é…ç½®ä»£ç†ä»¥è®¿é—® YouTube/Twitchï¼ˆå¯é€‰ï¼‰
   - é…ç½® config.yaml çš„æ‰€æœ‰å¿…è¦è®¾ç½®
   - è®¾ç½® YouTube é¢‘é“ï¼Œæ”¯æŒ Holodex APIï¼ˆå¯é€‰ï¼‰
   - è®¾ç½® Twitch é¢‘é“åŠ OAuth Tokenï¼ˆå¯é€‰ï¼‰
     - è·å– OAuth Tokenï¼šhttps://streamlink.github.io/cli/plugins/twitch.html#authentication
   - é…ç½®é˜²æ’è½¦ç›‘æ§ç›´æ’­é—´ï¼ˆå¯è¿­ä»£æ·»åŠ å¤šä¸ªç›´æ’­é—´ï¼‰
   - é«˜çº§ API å¯†é’¥ï¼šHolodex (https://holodex.net/login)ã€Riot Games (https://developer.riotgames.com/)
   - è‡ªåŠ¨è·å–å¹¶æ›´æ–° RTMP æ¨æµåœ°å€

2. å¼€å§‹ç›´æ’­ï¼š

   ```bash
   ./bilistream
   ```

3. ç™»å½•å“”å“©å“”å“©ï¼š

   ```bash
   ./bilistream login
   ```

4. å‘é€å¼¹å¹•ï¼š

   ```bash
   ./bilistream send-danmaku <å¼¹å¹•å†…å®¹>
   ```

5. æ›´æ¢ç›´æ’­é—´å°é¢ï¼š

   ```bash
   ./bilistream replace-cover <å›¾ç‰‡è·¯å¾„>
   ```

6. æ›´æ–°ç›´æ’­é—´åˆ†åŒºï¼š

   ```bash
   ./bilistream update-area <åˆ†åŒºID>
   ```

7. æ›´æ–°å“”å“©å“”å“©ä»¤ç‰Œï¼š

   ```bash
   ./bilistream renew
   ```

8. è·å–ç›´æ’­çŠ¶æ€ï¼š

   ```bash
   ./bilistream get-live-status <å¹³å°> [é¢‘é“ID]
   # å¹³å°: YT, TW, bilibili, all
   ```

9. **Web UIï¼ˆæ§åˆ¶é¢æ¿ï¼‰ï¼š**

   ```bash
   ./bilistream webui
   # æˆ–æŒ‡å®šè‡ªå®šä¹‰ç«¯å£
   ./bilistream webui --port 3150
   ```
   
   å¯åŠ¨ç°ä»£åŒ–çš„ Web æ§åˆ¶é¢æ¿ï¼š
   - å®æ—¶ç›‘æ§ Bilibiliã€YouTube å’Œ Twitch çŠ¶æ€
   - æ˜¾ç¤ºå½“å‰ç›‘æ§çš„é¢‘é“åç§°
   - ä¸€é”®å¼€å§‹/åœæ­¢ç›´æ’­
   - å‘é€å¼¹å¹•æ¶ˆæ¯
   - æ›´æ–°ç›´æ’­åˆ†åŒºï¼ˆä¸‹æ‹‰é€‰æ‹©ï¼Œæ— éœ€è®°å¿† IDï¼‰
   - é¢‘é“ç®¡ç†åŠŸèƒ½ - ä»é¢„å®šä¹‰åˆ—è¡¨ä¸­é€‰æ‹©ç›‘æ§ç›®æ ‡
   - æ¯ 60 ç§’è‡ªåŠ¨åˆ·æ–°çŠ¶æ€
   - å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯
   - é»˜è®¤è®¿é—®åœ°å€ï¼šhttp://localhost:3150
   - å¯åŠ¨æ—¶æ˜¾ç¤ºæ‰€æœ‰å¯è®¿é—®çš„ç½‘ç»œåœ°å€ï¼ˆæœ¬åœ°å’Œå±€åŸŸç½‘ï¼‰

10. ç”Ÿæˆå‘½ä»¤è¡¥å…¨è„šæœ¬ï¼š

   ```bash
   ./bilistream completion <shell>
   # shell: bash, zsh, fish
   ```

### å¼¹å¹•å‘½ä»¤åŠŸèƒ½

å¼¹å¹•å‘½ä»¤æ ¼å¼ï¼š

```txt
%è½¬æ’­%YT/TW%é¢‘é“åç§°%åˆ†åŒºåç§°
é¢‘é“åç§°å¿…é¡»åœ¨ YT/TW_channels.txt ä¸­
```

ç¤ºä¾‹ï¼š

```txt
%è½¬æ’­%YT%kamito%è‹±é›„è”ç›Ÿ
%è½¬æ’­%TW%kamito%æ— ç•å¥‘çº¦
```

ç³»ç»Ÿä¼šæ£€æŸ¥ç›´æ’­æ ‡é¢˜å¹¶æ ¹æ®éœ€è¦è°ƒæ•´åˆ†åŒº IDã€‚ä¾‹å¦‚ï¼Œå¦‚æœç›´æ’­æ ‡é¢˜åŒ…å« "Valorant"ï¼Œæ— è®ºæŒ‡å®šçš„åˆ†åŒºåç§°æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šå°†åˆ†åŒº ID è®¾ç½®ä¸º 329ï¼ˆæ— ç•å¥‘çº¦ï¼‰ã€‚æŸ¥çœ‹ [https://api.live.bilibili.com/room/v1/Area/getList](https://api.live.bilibili.com/room/v1/Area/getList) è·å–æ›´å¤šåˆ†åŒºåç§°å’Œ IDã€‚

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [unlicense](LICENSE) è®¸å¯è¯ã€‚

## è‡´è°¢

- [limitcool/bilistream](https://github.com/limitcool/bilistream)
- [Isoheptane/bilibili-live-danmaku-cli](https://github.com/Isoheptane/bilibili-live-danmaku-cli)
